function scroll_to_address(e,s){if(void 0!==e&&null!==e){var i=0;i="top"==s?$("#center_panel").height():"bottom"==s?0:window.innerHeight/2;var t=$(".insaddr.addr_"+e);if(void 0!==t&&null!==t&&void 0!==t[0]&&null!==t[0]){var r=t[0].documentOffsetTop()-i;r=Math.max(0,r),$("#center_panel").scrollTo(r,{axis:"y"}),r2ui._dis.scroll_offset=r}}}function handleClick(e){if($(e.target).hasClass("addr")){if($(e.target).hasClass("history")){var s=e.target.className.split(" ").filter(function(e){return"history_idx_"==e.substr(0,"history_idx_".length)});s=String(s).split("_")[2],r2ui.history_idx=s,do_jumpto(r2ui.history[s])}else if($(e.target).hasClass("insaddr")){var i=get_address_from_class(e.target);r2ui._dis.selected=e.target,r2ui._dis.selected_offset=i,rehighlight_iaddress(i),r2ui.history_push(i),render_history();var t,r,i,d=!1;if("flat"==r2ui._dis.display&&(t=$(r2ui._dis.selected).closest(".instructionbox").next().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])>$("#gbox .instructionbox").length-10&&(d=!0,i=get_address_from_class(t)),r=$(r2ui._dis.selected).closest(".instructionbox").prev().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])<10&&(d=!0,i=get_address_from_class(r))),"graph"==r2ui._dis.display){var t=$(r2ui._dis.selected).closest(".instruction").next().find(".insaddr")[0];void 0!==t&&null!==t||(t=$(r2ui._dis.selected).closest(".basicblock").next().find(".insaddr")[0]);var r=$(r2ui._dis.selected).closest(".instruction").prev().find(".insaddr")[0];void 0!==r&&null!==r||(r=$(r2ui._dis.selected).closest(".basicblock").prev().find(".insaddr").last()[0])}d&&(r2ui.seek(i,!1),rehighlight_iaddress(i),scroll_to_address(i))}}else if($(e.target).hasClass("fvar")||$(e.target).hasClass("farg")){var n=null,i=get_address_from_class(e.target,"faddr");r2ui._dis.selected=e.target,r2ui._dis.selected_offset=i;var a=e.target.className.split(" ");for(var l in a){var o=a[l];0===o.indexOf("id_")&&(n=o.substring(3))}null!==n&&rehighlight_iaddress(n,"id")}}function handleDoubleClick(e){if($(e.target).hasClass("addr")&&!$(e.target).hasClass("insaddr")){var s=get_address_from_class(e.target);do_jumpto(s)}}function handleKeypress(e){var s=e.keyCode||e.charCode||e.which||0,i=String.fromCharCode(s);if(!e.ctrlKey&&!e.metaKey&&"INPUT"!==$(e.target).prop("tagName")&&"TEXTAREA"!==$(e.target).prop("tagName")&&null===r2ui._dis.renaming){if(" "===i&&(do_switchview(),e.preventDefault()),"m"===i&&"graph"==r2ui._dis.display&&toggle_minimap(),"h"===i&&do_jumpto(r2ui.history_prev()),"l"===i&&do_jumpto(r2ui.history_next()),"j"===i){var t=!1;if($(r2ui._dis.selected).hasClass("insaddr")){var r;if("flat"==r2ui._dis.display&&(r=$(r2ui._dis.selected).closest(".instructionbox").next().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])>$("#gbox .instructionbox").length-10&&(t=!0)),"graph"==r2ui._dis.display){var r=$(r2ui._dis.selected).closest(".instruction").next().find(".insaddr")[0];void 0!==r&&null!==r||(r=$(r2ui._dis.selected).closest(".basicblock").next().find(".insaddr")[0])}var d=get_address_from_class(r);t?r2ui.seek(d,!1):(r2ui.history_push(d),render_history(),r2ui._dis.selected=r,r2ui._dis.selected_offset=d),rehighlight_iaddress(d),scroll_to_address(d)}}if("k"===i){var t=!1;if($(r2ui._dis.selected).hasClass("insaddr")){var n;if("flat"==r2ui._dis.display&&(n=$(r2ui._dis.selected).closest(".instructionbox").prev().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])<10&&(t=!0)),"graph"==r2ui._dis.display){var n=$(r2ui._dis.selected).closest(".instruction").prev().find(".insaddr")[0];void 0!==n&&null!==n||(n=$(r2ui._dis.selected).closest(".basicblock").prev().find(".insaddr").last()[0])}var d=get_address_from_class(n);t?r2ui.seek(d,!1):(r2ui.history_push(d),render_history(),r2ui._dis.selected=n,r2ui._dis.selected_offset=d),rehighlight_iaddress(d),scroll_to_address(d)}}if("c"===i&&do_define(r2ui._dis.selected),"u"===i&&do_undefine(r2ui._dis.selected),"g"===i){var a=prompt("Go to");null!==a&&do_jumpto(a)}if(";"===i&&do_comment(r2ui._dis.selected),"n"===i&&do_rename(r2ui._dis.selected,e),"R"===i&&do_randomcolors(),27===s)if(null!==r2ui._dis.renaming)r2ui._dis.renaming.innerHTML=r2ui._dis.renameOldValue,r2ui._dis.renaming=null;else{var l=r2ui.history_prev();void 0!==l&&null!==l&&r2ui.seek(l,!1),scroll_to_address(l)}13===s&&r2ui._dis.goToAddress()}}function do_switchview(){$("#switch_button").text("loading ...");var e=get_address_from_class(r2ui._dis.selected);void 0!==e&&null!==e&&("flat"===r2ui._dis.display?r2ui._dis.display_graph():"graph"===r2ui._dis.display&&r2ui._dis.display_flat(),r2ui.seek(e,!0),scroll_to_address(e)),$("#switch_button").text("switch view")}function do_jumpto(e){var s=$(".insaddr.addr_"+e);s.length>0?(r2ui.history_push(e),r2ui._dis.selected=s[0],r2ui._dis.selected_offset=e,render_history()):r2ui.seek(e,!0),rehighlight_iaddress(e),scroll_to_address(e)}function do_rename(e,s){var i=get_address_from_class(e);if($(e).hasClass("addr")&&$(e).hasClass("flag")){var t="*";$(e).hasClass("function")&&(t="functions"),$(e).hasClass("import")&&(t="functions"),$(e).hasClass("symbol")&&(t="symbols"),$(e).hasClass("reloc")&&(t="relocs"),$(e).hasClass("section")&&(t="sections"),$(e).hasClass("string")&&(t="strings");var r=$(e).html(),d=prompt("New name",r);null!==d&&(rename(i,r,d,t),store_scroll_offset(),r2ui.seek("$$",!1),scroll_to_last_offset())}else if(null===r2ui._dis.renaming&&null!==e&&$(e).hasClass("addr")){if(r2ui._dis.selected=e,r2ui._dis.selected_offset=i,r2ui._dis.renaming=e,r2ui._dis.renameOldValue=e.innerHTML,r2ui._dis.rbox=document.createElement("input"),r2ui._dis.rbox.setAttribute("type","text"),r2ui._dis.rbox.setAttribute("id","rename"),r2ui._dis.rbox.setAttribute("style","border-width: 0;padding: 0;"),r2ui._dis.rbox.setAttribute("onChange","handleInputTextChange()"),$(e).hasClass("insaddr")){var n=get_offset_flag(i);r2ui._dis.rbox.setAttribute("value",n),r2ui._dis.rbox.setSelectionRange(n.length,n.length)}else r2ui._dis.rbox.setAttribute("value",r2ui._dis.renameOldValue),r2ui._dis.rbox.setSelectionRange(r2ui._dis.renameOldValue.length,r2ui._dis.renameOldValue.length);r2ui._dis.renaming.innerHTML="",r2ui._dis.renaming.appendChild(r2ui._dis.rbox),setTimeout("r2ui._dis.rbox.focus();",200),s.returnValue=!1,s.preventDefault()}else null===r2ui._dis.renaming&&null!==e&&$(e).hasClass("faddr")&&(i=get_address_from_class(e,"faddr"),r2ui._dis.selected=e,r2ui._dis.selected_offset=i,r2ui._dis.renaming=e,r2ui._dis.renameOldValue=e.innerText,r2ui._dis.rbox=document.createElement("input"),r2ui._dis.rbox.setAttribute("type","text"),r2ui._dis.rbox.setAttribute("id","rename"),r2ui._dis.rbox.setAttribute("style","border-width: 0;padding: 0;"),r2ui._dis.rbox.setAttribute("onChange","handleInputTextChange()"),r2ui._dis.rbox.setAttribute("value",r2ui._dis.renameOldValue),r2ui._dis.rbox.setSelectionRange(r2ui._dis.renameOldValue.length,r2ui._dis.renameOldValue.length),r2ui._dis.renaming.innerHTML="",r2ui._dis.renaming.appendChild(r2ui._dis.rbox),setTimeout("r2ui._dis.rbox.focus();",200),s.returnValue=!1,s.preventDefault());update_binary_details()}function do_comment(e){var s=get_address_from_class(e),i=prompt("Comment");null!==i&&(r2.cmd("CC "+i+" @ "+s),r2ui.seek(s,!1),scroll_to_address(s))}function do_undefine(e){var s=get_address_from_class(e);r2.cmd("af-"),r2.update_flags(),update_binary_details(),"graph"==r2ui._dis.display&&r2ui._dis.display_flat(),r2ui.seek(s,!1),scroll_to_address(s)}function do_define(e){var s=get_address_from_class(e),i=prompt("Function name?");null!==i&&(r2.cmd("af "+i+" @ "+s),r2.update_flags(),update_binary_details(),r2ui.seek(s,!1),scroll_to_address(s))}var DisasmPanel=function(){this.display="flat",this.min=0,this.max=0,this.block=512,this.base="entry0",this.selected=null,this.selected_offset=null,this.tmp_address=null,this.renaming=null,this.renameOldValue="",this.rbox=null,this.panel=$("#disasm_tab")[0],this.scroll_offset=null,this.minimap=!0,this.instructions=[],this.scrolling=!1};DisasmPanel.prototype.render=function(e){$("#center_panel").unbind("click"),$(document).unbind("keypress"),$(document).unbind("click"),$(document).unbind("dblclick"),$("#center_panel").scroll(on_scroll),$(document).keypress(handleKeypress),$(document).click(handleClick),$(document).dblclick(handleDoubleClick),$(document).contextmenu({delegate:".addr",menu:[{title:"jump to address<kbd>g</kbd>",cmd:"goto"},{title:"rename<kbd>n</kbd>",cmd:"rename"},{title:"add comment<kbd>;</kbd>",cmd:"comment"},{title:"code<kbd>c</kbd>",cmd:"define"},{title:"undefine<kbd>u</kbd>",cmd:"undefine"},{title:"random colors<kbd>R</kbd>",cmd:"randomcolors"},{title:"switch disasm/graph<kbd>s</kbd>",cmd:"switchview"}],preventSelect:!0,taphold:!0,preventContextMenuForPopup:!0,show:!1,position:function(e,s){return{my:"left+100 top-10",at:"left bottom",of:s.target}},beforeOpen:function(e,s){var i=get_address_from_class(s.target[0]),t=[],r=[],d=null,n=null;if(r2.cmd("axf @"+i,function(e){var s=e.split("\n");for(var i in s)""!==s[i]&&(t[t.length]=s[i])}),t.length>0){$(document).contextmenu("showEntry","xrefs_to",!0);var a=[];for(var l in t){var o=t[l].split(" ")[1],u=t[l].split(" ")[0];a[a.length]={title:o+"<kbd>"+u+"</kbd>",cmd:"jumpto_"+o}}var d={title:"xrefs to",children:a}}if(r2.cmd("axt @"+i,function(e){var s=e.split("\n");for(var i in s)""!==s[i]&&(r[r.length]=s[i])}),r.length>0){$(document).contextmenu("showEntry","xrefs_from",!0);var a=[];for(var l in r){var o=r[l].split(" ")[1],u=r[l].split(" ")[0];a[a.length]={title:o+"<kbd>"+u+"</kbd>",cmd:"jumpto_"+o}}var n={title:"xrefs from",children:a}}var c=[{title:"jump to address<kbd>g</kbd>",cmd:"goto"},{title:"rename<kbd>n</kbd>",cmd:"rename"},{title:"add comment<kbd>;</kbd>",cmd:"comment"},{title:"code<kbd>c</kbd>",cmd:"define"},{title:"undefine<kbd>u</kbd>",cmd:"undefine"},{title:"random colors<kbd>R</kbd>",cmd:"randomcolors"},{title:"switch disasm/graph<kbd>s</kbd>",cmd:"switchview"}];null===n&&null===d||(null!==d&&(c[c.length]=d),null!==n&&(c[c.length]=n)),$(document).contextmenu("replaceMenu",c),r2.cmdj("pdj 1 @"+i,function(e){e&&(e[0].fcn_addr==e[0].offset?($(document).contextmenu("showEntry","define",!1),$(document).contextmenu("showEntry","undefine",!0)):($(document).contextmenu("showEntry","define",!0),$(document).contextmenu("showEntry","undefine",!1)))}),s.target.hasClass("insaddr")?($(document).contextmenu("showEntry","comment",!0),$(document).contextmenu("showEntry","rename",!0)):($(document).contextmenu("showEntry","comment",!1),$(document).contextmenu("showEntry","rename",!0),$(document).contextmenu("showEntry","define",!1),$(document).contextmenu("showEntry","undefine",!1)),(s.target.hasClass("reloc")||s.target.hasClass("symbol")||s.target.hasClass("import"))&&($(document).contextmenu("showEntry","comment",!1),$(document).contextmenu("showEntry","rename",!1),$(document).contextmenu("showEntry","define",!1),$(document).contextmenu("showEntry","undefine",!1)),$.contains($("#disasm_tab")[0],s.target[0])||$(document).contextmenu("showEntry","switchview",!1)},select:function(e,s){$(document).contextmenu("close");var i=s.target[0],t=get_address_from_class(i);switch(0==s.cmd.indexOf("jumpto_")&&(t=s.cmd.substring(s.cmd.indexOf("jumpto_")+7),do_jumpto(t)),s.cmd){case"goto":do_goto();break;case"comment":do_comment(i);break;case"rename":do_rename(i,e);break;case"define":do_define(i);break;case"undefine":do_undefine(i);break;case"randomcolors":do_randomcolors(i);break;case"switchview":do_switchview(i)}}}),"flat"===e?this.display_flat():"graph"===e&&this.display_graph();var s=null;s=null!==this.selected_offset?this.selected_offset:this.base,r2ui.seek(s,!0),s=0===s.indexOf("0x")?address_canonicalize(s):r2.get_flag_address(s),scroll_to_address(s)},DisasmPanel.prototype.seek=function(e){var s=this.panel,i=!1;"graph"===this.display&&(s.innerHTML="",r2.cmd("agj "+e,function(e){s.innerHTML="<div id='minimap'></div></div><div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>",render_graph(e)===!1&&(i=!0)})),i&&this.display_flat(),"flat"===this.display&&(this.min=this.max=0,r2.get_disasm_before_after(e,-100,100,function(e){s.innerHTML="<div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>",r2ui._dis.instructions=e,render_instructions(r2ui._dis.instructions)})),this.selected=get_element_by_address(e),this.selected_offset=e,render_history(),rehighlight_iaddress(e)},DisasmPanel.prototype.display_graph=function(){this.display="graph",$("#main_panel").removeClass("ec_gui_background"),$("#main_panel").addClass("ec_gui_alt_background"),$("#minimap").length&&($("#minimap")[0].innerHTML="")},DisasmPanel.prototype.display_flat=function(){this.display="flat",$("#main_panel").removeClass("ec_gui_alt_background"),$("#main_panel").addClass("ec_gui_background"),$("#minimap").length&&($("#minimap")[0].innerHTML="")},DisasmPanel.prototype.goToAddress=function(){if(null===this.renaming&&null!==this.selected&&this.selected.className.indexOf(" addr ")>-1){var e=get_address_from_class(this.selected);if(this.selected.className.indexOf("ec_gui_dataoffset")>-1)return void r2ui.openpage(e,2);void 0!==e&&null!==e&&(e=address_canonicalize(e),do_jumpto(e))}},DisasmPanel.prototype.handleInputTextChange=function(){if(null!==this.renaming&&this.rbox.value.length>0){if($(this.selected).hasClass("insaddr")){var e=get_offset_flag(r2ui._dis.selected_offset),s="offsets";r2.cmdj("afij @ "+r2ui._dis.selected_offset,function(e){null!==e&&void 0!==e&&"0x"+e[0].offset.toString(16)===r2ui._dis.selected_offset&&(s="functions")}),rename(r2ui._dis.selected_offset,e,this.rbox.value,s)}else if($(this.selected).hasClass("faddr"))$(this.selected).hasClass("fvar")?r2.cmd("afvn "+r2ui._dis.renameOldValue+" "+r2ui._dis.rbox.value+" @ "+r2ui._dis.selected_offset,function(){}):$(this.selected).hasClass("farg")&&r2.cmd("afan "+r2ui._dis.renameOldValue+" "+r2ui._dis.rbox.value+" @ "+r2ui._dis.selected_offset,function(){});else{var e=r2ui._dis.renameOldValue;0===e.indexOf("0x")&&(e=""),rename(r2ui._dis.selected_offset,e,r2ui._dis.rbox.value,"*")}var i;"flat"==this.display&&(i=$(this.selected).closest(".instructionbox").find(".insaddr")[0]),"graph"==this.display&&(i=$(this.selected).closest(".instruction").find(".insaddr")[0]),this.renaming=null;var t=get_address_from_class(i);update_binary_details(),r2ui.seek(t,!1),scroll_to_address(t)}};
var EntropyPanel=function(){};EntropyPanel.prototype.render=function(){var t="<table id='entropy_chart'>";r2.cmd("p=",function(i){var n=i.split("\n");for(var a in n){var r=n[a],e=r.split(" ")[0],d=parseInt(r.split(" ")[1],16);d>0&&(t+="<tr><td>"+e+"</td><td>"+d+"</td></tr>")}}),t+="</table>",$("#entropy_tab").html("<pre id='hexdump' style='color:rgb(127,127,127);''>"+t+"</pre>"),$("#entropy_chart").horizontalTableGraph()},jQuery.fn.horizontalTableGraph=function(){$(this).find("thead").remove();var t=0;$(this).find("tr").each(function(){$(this).removeClass(),$(this).find("td").eq(0).animate({width:"50px"},1e3),$(this).find("td").eq(1).animate({width:"500px"},1e3).css("text-align","left"),$(this).find("td").eq(1).css("width","500px");var i=$(this).find("td").eq(1).html();t=Math.max(t,i)}),$(this).find("tr").each(function(){var i=$(this).find("td").eq(1).html(),n=$("<span>").html(i);n.css({display:"block",width:"0px",backgroundColor:"#600",marginBottom:"0px",padding:"0px",color:"#FFF"}),$(this).find("td").eq(1).html(n),n.animate({width:100*i/t+"%"},"slow")})};
function hex_menu_to_console(){if(value="",r2ui._hex.dragEnd>-1&&r2ui._hex.dragStart>-1){if(r2ui._hex.dragEnd+1<r2ui._hex.dragStart){var e=$("span.dword").slice(r2ui._hex.dragEnd,r2ui._hex.dragStart+1).addClass("autohighlighti");for(var r in e)value+=uncolor_dword(e[r].innerHTML)}else{var e=$("span.dword").slice(r2ui._hex.dragStart,r2ui._hex.dragEnd+1);for(var r in e)value+=uncolor_dword(e[r].innerHTML)}var t=$("#cmd_output").text();$("#cmd_output").html(t+"\n"+value)}}function handle_hex_keypress(e){var r=e.keyCode||e.charCode||e.which||0;String.fromCharCode(r)}function scroll_to_hexaddress(e,r){if(void 0!==e&&null!==e){var t=0;t="top"==r?$("#center_panel").height():"bottom"==r?0:window.innerHeight/2;var i=$(".hexaddr.hexaddr_"+e);if(void 0!==i&&null!==i&&void 0!==i[0]&&null!==i[0]){var n=i[0].documentOffsetTop()-t;n=Math.max(0,n),$("#center_panel").scrollTo(n,{axis:"y"}),r2ui._dis.scroll_offset=n}}}function on_hex_scroll(){if(!r2ui._hex.scrolling){r2ui._hex.scrolling=!0;var e=$("#center_panel").scrollTop(),r=$(".hexoffset").height()-$("#center_panel").height();$("#hex_tab");if(0===e){var t=get_hexdump(r2ui._hex.first-r2ui._hex.block+16);for(var i in r2ui._hex.lines)t[i]=r2ui._hex.lines[i];r2ui._hex.lines=t,html="<div class='hex'>",html+=render_hexdump(r2ui._hex.lines),html+="</div>",$("#hex_tab").html(html),scroll_to_hexaddress("0x"+r2ui._hex.first.toString(16),"bottom"),r2ui._hex.first=r2ui._hex.first-r2ui._hex.block+16}else if(e>r-10){var t=get_hexdump(r2ui._hex.last-16);for(var i in t)r2ui._hex.lines[i]=t[i];r2ui._hex.last=r2ui._hex.last-16+r2ui._hex.block,html="<div class='hex'>",html+=render_hexdump(r2ui._hex.lines),html+="</div>",$("#hex_tab").html(html),scroll_to_hexaddress("0x"+r2ui._hex.last.toString(16),"top")}$(".dword").click(function(e){if($(e.target).hasClass("dword")){var r=e.target.className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$(".autohighlighti").removeClass("autohighlighti"),$("."+r).addClass("autohighlighti")}}),r2ui._hex.scrolling=!1}}function get_hexdump(e){var r={};return r2.cmd("px "+r2ui._hex.block+"@"+e,function(e){var t=e.split("\n");for(var i in t)if(i>1&&i<t.length-1){var n=t[i].split("  ")[0],o=t[i].split("  ")[1].split(" "),a=t[i].split("  ")[2].match(/.{1,2}/g),s={offset:n,dwords:o,text:a};r[n]=s}}),r}function color_dword(e){return e.replace(/(7f)/gi,function(e){return"<font class='ec_b0x7f'>"+e+"</font>"}).replace(/(ff)/gi,function(e){return"<font class='ec_b0xff'>"+e+"</font>"}).replace(/(00)/gi,function(e){return"<font class='ec_b0x00'>"+e+"</font>"})}function uncolor_dword(e){return void 0!==e&&null!==e?e.replace(/(<([^>]+)>)/gi,""):""}function render_hexdump(e){r2ui._hex.scrolling=!0;var r="<div class='hexoffset'><div><div>",t="<div class='hexdump' style='color: white;'>",i="<div class='hextext'>";for(var n in e){var o=e[n];r+="<span class='hexaddr ec_offset hexaddr_"+address_canonicalize(o.offset)+"'>"+o.offset+"</span><br>";for(var a in o.dwords){var s=parseInt(o.offset,16);s+=2*a,dword_offset="0x"+s.toString(16),t+="<span class='dword dword_"+address_canonicalize(dword_offset)+" line_"+address_canonicalize(o.offset)+"'>"+color_dword(o.dwords[a])+"</span> "}t+="<br>";for(var a in o.text){var s=parseInt(o.offset,16);s+=2*a,dword_offset="0x"+s.toString(16),i+="<span class='dword dword_"+address_canonicalize(dword_offset)+"'>"+o.text[a]+"</span>"}i+="<br>"}return i+="</div>",t+="</div>",r+="</div></div></div>",r+t+i}function rangeMouseDown(e){if(isRightClick(e))return!1;var r=$("span.dword");r2ui._hex.dragStart=r.index($(this)),r2ui._hex.isDragging=!0,"undefined"!=typeof e.preventDefault&&e.preventDefault(),document.documentElement.onselectstart=function(){return!1}}function rangeMouseUp(e){if(isRightClick(e))return!1;var r=$("span.dword");r2ui._hex.dragEnd=r.index($(e.target)),r2ui._hex.isDragging=!1,r2ui._hex.dragEnd>-1&&selectRange(),document.documentElement.onselectstart=function(){return!0}}function rangeMouseMove(){if(r2ui._hex.isDragging){var e=$("span.dword");r2ui._hex.dragEnd=e.index($(this)),selectRange()}}function selectRange(){if($("span.dword").removeClass("autohighlighti"),r2ui._hex.dragEnd+1<r2ui._hex.dragStart){var e=$("span.dword").slice(r2ui._hex.dragEnd,r2ui._hex.dragStart+1).addClass("autohighlighti");for(var r in e)if(void 0!==e[r].className){var t=e[r].className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$("."+t).addClass("autohighlighti")}}else{var e=$("span.dword").slice(r2ui._hex.dragStart,r2ui._hex.dragEnd+1);for(var r in e)if(void 0!==e[r].className){var t=e[r].className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$("."+t).addClass("autohighlighti")}}}function isRightClick(e){return e.which?3==e.which:e.button?2==e.button:!1}function handleInputHexChange(){if(null!==r2ui._hex.renaming&&r2ui._hex.rbox.value.length>0){var e=r2ui._hex.rbox.value;if(e=e.match(/^[0-9a-f]{0,4}$/gi),null===e&&(alert("Invalid dword"),e=r2ui._hex.renameOldValue),e.length<4){for(var r="0",t=5-e.length,i=0;t>i;i++)r+="0";e=(r+e).slice(-1*t)}e!==r2ui._hex.renameOldValue&&(r2.cmdj("wx 0x"+e.substring(0,2)+" @ "+parseInt(r2ui._hex.dword,16),function(){}),r2.cmdj("wx 0x"+e.substring(2,4)+" @ "+(parseInt(r2ui._hex.dword,16)+1),function(){})),r2ui._hex.renaming[0].innerHTML="<span class='dword dword_"+r2ui._hex.dword+" line_"+r2ui._hex.address+"'>"+color_dword(e)+"</span>",$(".autohighlighti").removeClass("autohighlighti"),$(".dword_"+r2ui._hex.dword).addClass("autohighlighti"),r2ui._hex.renaming=null,r2ui._hex.rbox=null}}function handle_hex_double_click(e){if($(e.target).hasClass("hexaddr")){var r=get_address_from_class(e.target,"hexaddr");return console.log(r),void(r2ui._dis.selected_offset=r)}var t=!0;if(r2.cmdj("ij",function(e){-1==e.core.mode.indexOf("w")&&(t=!1,alert("Not in write mode"))}),t){var i=null;if($(e.target).hasClass("dword"))i=$(e.target);else{if(!$(e.target).parent().hasClass("dword"))return;i=$(e.target).parent()}if(null===r2ui._hex.renaming&&null!==i&&i.hasClass("dword")){var n=i[0].className.split(" "),o=0,a=0;for(var s in n)n[s].indexOf("dword_")>-1?o=n[s].substr(6):n[s].indexOf("line_")>-1&&(a=n[s].substr(5));r2ui._hex.dword=o,r2ui._hex.address=a,r2ui._hex.renaming=i,r2ui._hex.renameOldValue=uncolor_dword(i[0].innerHTML);var l=document.createElement("form");l.setAttribute("onSubmit","handleInputHexChange(); return false;"),l.setAttribute("style","display:inline;"),r2ui._hex.rbox=document.createElement("input"),r2ui._hex.rbox.setAttribute("type","text"),r2ui._hex.rbox.setAttribute("id","rename"),r2ui._hex.rbox.setAttribute("style","border-width: 0;padding: 0; background-color:yellow; font-family: monospace; font-size: 10pt;"),r2ui._hex.rbox.setAttribute("size","4"),r2ui._hex.rbox.setAttribute("maxlength","4"),r2ui._hex.rbox.setAttribute("value",r2ui._hex.renameOldValue),r2ui._hex.rbox.setSelectionRange(r2ui._hex.renameOldValue.length,r2ui._hex.renameOldValue.length),r2ui._hex.renaming[0].innerHTML="",l.appendChild(r2ui._hex.rbox),r2ui._hex.renaming[0].appendChild(l),setTimeout("r2ui._hex.rbox.focus();",200),e.returnValue=!1,e.preventDefault()}}}function highlight_in(e){var r=null;if($(e.target).hasClass("dword"))r=e.target;else{if(!$(e.target).parent().hasClass("dword"))return;r=$(e.target).parent()[0]}var t=r.className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$("."+t).addClass("autohighlighti")}function highlight_out(){r2ui._hex.isDragging||$(".autohighlighti").removeClass("autohighlighti")}function highlight_dword(e){if($(e.target).hasClass("dword")){var r=e.target.className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$(".autohighlighti").removeClass("autohighlighti"),$("."+r).addClass("autohighlighti")}}var HexPanel=function(){this.block=1024,this.base="entry0",this.first=0,this.last=0,this.lines={},this.scrolling=!1,this.renaming=null,this.dwors=null,this.renameOldValue="",this.rbox=null,this.address=null,this.scroll_offset=0,this.dragStart=-1,this.dragEnd=-1,this.isDragging=!1};HexPanel.prototype.scrollTo=function(){},HexPanel.prototype.render=function(){r2ui.seek("$$",!1),$("#center_panel").unbind("click"),$(document).unbind("keypress"),$(document).unbind("click"),$(document).unbind("dblclick"),$("#center_panel").scroll(on_hex_scroll),$(document).keypress(handle_hex_keypress),$(document).dblclick(handle_hex_double_click),$("#center_panel").contextmenu({delegate:".dword",menu:[{title:"bytes to console",cmd:"hex_menu_to_console"}],preventSelect:!0,preventContextMenuForPopup:!0,show:!1,select:function(e,r){switch($(document).contextmenu("close"),r.cmd){case"hex_menu_to_console":hex_menu_to_console()}}})},HexPanel.prototype.seek=function(e){this.base=e,this.first=parseInt(e,16),this.last=parseInt(e,16)+this.block,this.lines=get_hexdump(e),html="<div class='hex'>",html+=render_hexdump(this.lines),html+="</div>",$("#hex_tab").html(html),$(document).on("dblclick",".dword",handle_hex_double_click),$(document).on("mousedown",".dword",rangeMouseDown),$(document).on("mousemove",".dword",rangeMouseMove),$(document).on("mouseup",".dword",rangeMouseUp),r2ui._hex.scrolling=!1};
var output=[],logger=null,LogsPanel=function(){};LogsPanel.prototype.render=function(){function t(t){return t.replace(/[\x26\x0A\<>'"]/g,function(t){return"&#"+t.charCodeAt(0)+";"})}function e(){console.log("loginit",logger);var e=document.getElementById("logs_out");null===logger&&(logger=r2.getTextLogger()),logger.render=function(){e.innerHTML=output.join("<br />")},logger.on("message",function(e){output.push(t(e.text)),logger.render()}),logger.render(),logger.autorefresh(3)}function n(){var t=document.getElementById("logs_nick").value.trim(),n=document.getElementById("logs_input").value.trim();e(),n&&logger&&(t&&(n="<"+t+"> "+n),logger.send(n)),document.getElementById("logs_input").value=""}$("#logs_tab").html('<div><table width="100%"><tr><td><input class="input" id="logs_nick" style="width:4em" value="user" /></td><td width="100%"><input class="input" id="logs_input" style="width:100%" /></td><td><input type="button" class="button" id="logs_button" value="send" style="z-index:-20" /></td></tr></table><div id="logs_out" class="consoleout" style="z-index:-20"> </div></div>'),r2ui.selected_panel="Logs",$(document).ready(e),$("#logs_input").keypress(function(t){13==t.which&&n()}),$("#logs_button").click(n)};
var ProjectsPanel=function(){};ProjectsPanel.prototype.render=function(){$("#projects_tab").html('<div><div style="color: white;">Open Project:</div><div id="projects" style="color:rgb(127,127,127);"></div><div id="button"><br/><input id="submit" type="submit" value="Save Project" /></div></div>'),r2.cmdj("Plj",function(e){var t=[];for(var r in e){var n=e[r],o={label:n};t[t.length]=o}$("#projects").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#projects").tree("loadData",t),$("#submit").on("click",function(){var e=prompt("Project Name:",r2.project_name);""!==e?r2.cmd(":Ps "+e,function(){}):alert("Enter a valid name"),r2.project_name=e}),$(".jqtree-element").on("click",function(){var e=$(this)[0].firstChild.innerText;r2.cmd("Po "+e,function(){}),r2.project_name=e,window.location.assign("./p")})})};
var SettingsPanel=function(){};SettingsPanel.prototype.render=function(){var t='<div><h3>Colors:</h3><br/><iframe id="colors_frame" name="colors_frame" src="colors.html" width="100%" height="400px"></iframe></div><br/>',e="<div><h3>Settings:</h3><br/>";e+='<div>Test: <input id="test" type="checkbox" /></div>',e+="</div><br/>",e+='<div><input value="Randomize colors" type="button" onclick="r2.cmd(\'ecr\');"></div>';var i=e+t;$("#settings_tab").html(i),$("#settings_tab").css("color","rgb(127,127,127);"),$("input[type=checkbox]").onoff()};
var StringsPanel=function(){};StringsPanel.prototype.render=function(){$("#strings_tab").html('<div id="strings" style="color:rgb(127,127,127);"></div>'),$("#strings").before('<div class="ui-toolbar ui-widget-header ui-helper-clearfix" style="padding:5px;"><input id="search_string" type="text" placeholder="Search "><input id="string_length" type="text" placeholder="Length" style="margin-left:50px;"></div>'),r2.cmdj("izj",function(t){var e=[];for(var r in t){var n=t[r],l={offset:n.paddr,label:atob(n.string),children:[{label:"vaddr: 0x"+n.vaddr.toString(16)},{label:"paddr: 0x"+n.paddr.toString(16)},{label:"length: "+n.length},{label:"type: "+n.type}]};e[e.length]=l}e=e.sort(function(t,e){return t.offset-e.offset}),$("#strings").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#strings").tree("loadData",e)}),$("#search_string").change(function(){str=$("#search_string").val(),0==str.length?StringsPanel.prototype.render():r2.cmdj("izj",function(t){var e=[];for(var r in t){var n=t[r];if(str.toLowerCase(),str1=atob(n.string).slice(0,-1),str1.toLowerCase(),$("#string_length").val()){if(len=$("#string_length").val(),str1.indexOf(str)>=0&&n.length==len){var l={offset:n.paddr,label:atob(n.string),children:[{label:"vaddr: 0x"+n.vaddr.toString(16)},{label:"paddr: 0x"+n.paddr.toString(16)},{label:"length: "+n.length},{label:"type: "+n.type}]};e[e.length]=l}}else if(str1.indexOf(str)>=0){var l={offset:n.paddr,label:atob(n.string),children:[{label:"vaddr: 0x"+n.vaddr.toString(16)},{label:"paddr: 0x"+n.paddr.toString(16)},{label:"length: "+n.length},{label:"type: "+n.type}]};e[e.length]=l}}e=e.sort(function(t,e){return t.offset-e.offset}),$("#strings").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#strings").tree("loadData",e)})}),$("#string_length").change(function(){0==$("#string_length").val()||"undefined"==$("#string_length").val()?StringsPanel.prototype.render():r2.cmdj("izj",function(t){var e=[];for(var r in t){var n=t[r];if(str=$("#search_string").val(),str.toLowerCase(),str1=atob(n.string).slice(0,-1),str1.toLowerCase(),str.length>0&&$("#string_length").val()){if(len=$("#string_length").val(),n.length==len&&str1.indexOf(str)>=0){var l={offset:n.paddr,label:atob(n.string),children:[{label:"vaddr: 0x"+n.vaddr.toString(16)},{label:"paddr: 0x"+n.paddr.toString(16)},{label:"length: "+n.length},{label:"type: "+n.type}]};e[e.length]=l}}else if(len=$("#string_length").val(),n.length==len){var l={offset:n.paddr,label:atob(n.string),children:[{label:"vaddr: 0x"+n.vaddr.toString(16)},{label:"paddr: 0x"+n.paddr.toString(16)},{label:"length: "+n.length},{label:"type: "+n.type}]};e[e.length]=l}}e=e.sort(function(t,e){return t.offset-e.offset}),$("#strings").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#strings").tree("loadData",e)})})};
var TypesPanel=function(){this.data=[],this.optionSpacer=300};TypesPanel.prototype.insertData=function(e,t,n){"undefined"==typeof n&&(n=this.data);var r=e[0].trim();if(1==e.length)return void n.push({label:r,id:r,value:t});if(n.length<1)return n.push({label:r,children:[]}),void this.insertData(e.slice(1),t,n[0].children);for(var i in n)if(n[i].hasOwnProperty("label")&&n[i].label===r){if(n[i].hasOwnProperty("children"))return void this.insertData(e.slice(1),t,n[i].children);if(e.length>1)return n[i].children=[],void this.insertData(e.slice(1),t,n[i].children)}n.push({label:r}),e.length>1&&(n[n.length-1].children=[],this.insertData(e.slice(1),t,n[n.length-1].children))},TypesPanel.prototype.generateContent=function(){var e=this;r2.cmd("tk",function(t){var n=t.split("\n");for(var r in n){var i=n[r].split("=");if(!(i.length<2)){var a=i[0].split("."),o=i[1];a.length<2||e.insertData(a,o)}}})},TypesPanel.prototype.createBarButtons=function(){var e=$("#typesButtonBar"),t=$('<button id="addButton">Add type</button>');t.click(function(){var e=prompt("Enter C string:");r2.cmd('"td '+e+'"',function(){r2ui._typ.render()})}),e.append(t)},TypesPanel.prototype.createTree=function(){var e=$("#types");e.tree({data:this.data,slide:!1,autoOpen:0,useContextMenu:!1,selectable:!1,onCreateLi:function(e,t){var n="";if("undefined"!=typeof e.value&&(n+=" ("+e.value+")"),2==e.getLevel()){var r=r2ui._typ.optionSpacer;e.children&&0!=e.children.length&&(r-=5);var i="font-size: 80%; font-style: normal; font-family: monospace; cursor: pointer; position: absolute; left:"+r+"px";n+='<i class="remove" style="'+i+'"data-node-name="'+e.name+'">[-]</i>'}t.find(".jqtree-element").append(n)}}),e.on("click",".remove",function(e){var t=$(e.target).data("node-name");r2.cmd("t- "+t,function(){r2ui._typ.render()})})},TypesPanel.prototype.render=function(){$("#types_tab").html('<div id="typesButtonBar"></div><div id="types" style="color:rgb(127,127,127)"></div>'),this.createBarButtons(),this.data=[],this.maxstr=0,this.generateContent(),this.createTree()};